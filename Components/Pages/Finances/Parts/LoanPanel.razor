@namespace Hearth.Finances.Parts
@using Hearth.Icons
@using Hearth.Models

@if (Loans.Count() == 0)
{
	<div class="no-loan">
		<div class="nl-check">
			<IconCheckCircle Size="80" />
		</div>
		<div class="nl-text">
			No active Loan
		</div>
	</div>
}
else if (Loans.Count() >= 1)
{
	@if (IsSmall == true)
	{
		<div class="loan-panel">
			@* Loan Type and Toast *@
			<div class="lp-header">
				<div class="lp-h-header">
					@switch (CurrentLoan.Loan_Type)
					{
						case LOAN_TYPE.Mortgage:
							<span class="lp-h-h-icon">
								<IconHome Size=30 />
							</span>
							<span>Mortgage</span>
							break;
						case LOAN_TYPE.Car_Loan:
							<span class="lp-h-h-icon">
								<IconCar Size=30 />
							</span>
							<span>Car Loan</span>
							break;
						case LOAN_TYPE.Student_Loan:
							<span class="lp-h-h-icon">
								<IconUniCap Size=30 />
							</span>
							<span>Student Loan</span>
							break;
						default:
							<span class="lp-h-h-icon">
								<IconBox Size=30 />
							</span>
							<span>Other</span>
							break;
					}
				</div>
				@if (CurrentLoan.Loan_Status_C == LOAN_STATUS.Delinquent)
				{
					<div class="lp-h-toast">
						<span class="lp-h-t-icon"><IconExlemation /></span> <span class="lp-h-t-text">payment due in 2 days</span>
					</div>
				}
			</div>
			@* Loan Name and Payment *@
			<div class="lp-body">
				<button disabled=@(Loans.Count <= 1 || currentIndex == 0) class="arrow-btn" @onclick="PreviousLoan"> <IconCaret Direction="l" Size="30" /> </button>
				<div class="lp-b-body">
					<h2 class="lp-b-b-header loan-name-small">
						@CurrentLoan.Name
					</h2>
					<div class="lp-b-b-payment payment-small">

						@CurrentLoan.Payment_C.ToString("C0")

						@if (CurrentLoan.Amortized)
						{
							<span class="per-tag">/mo</span>
						}
					</div>
				</div>
				<button disabled=@(Loans.Count <= 1 || currentIndex == (Loans.Count - 1)) class="arrow-btn" @onclick="NextLoan"> <IconCaret Direction="r" Size="30" /> </button>
			</div>
			@* Progress Bar *@
			<div class="lp-footer">
				@* The Num container rests exactly above the bar container *@
				<div class="lp-f-bar-container bar-container-small">
					<div class="green-bar" style="width: @CurrentLoan.Percent_Of_Loan_Paid_C.ToString("P0")"></div>
					<div class="red-bar" style="width: @CurrentLoan.Percent_Of_Loan_Remaining_C.ToString("P0")"></div>
				</div>
			</div>
		</div>
	}
	else
	{
		<div class="loan-panel">
			@* Loan Type and Toast *@
			<div class="lp-header">
				<div class="lp-h-header">
					@switch (CurrentLoan.Loan_Type)
					{
						case LOAN_TYPE.Mortgage:
							<span class="lp-h-h-icon">
								<IconHome Size=30 />
							</span>
							<span>Mortgage</span>
							break;
						case LOAN_TYPE.Car_Loan:
							<span class="lp-h-h-icon">
								<IconCar Size=30 />
							</span>
							<span>Car Loan</span>
							break;
						case LOAN_TYPE.Student_Loan:
							<span class="lp-h-h-icon">
								<IconBlockGroup Size=30 />
							</span>
							<span>Student Loan</span>
							break;
						default:
							<span class="lp-h-h-icon">
								<IconCreditCard Size=30 />
							</span>
							<span>Other</span>
							break;
					}
				</div>
				@if (CurrentLoan.Loan_Status_C == LOAN_STATUS.Delinquent)
				{
					<div class="lp-h-toast">
						<span class="lp-h-t-icon"><IconExlemation /></span> <span class="lp-h-t-text">payment due in 2 days</span>
					</div>
				}
			</div>
			@* Loan Name and Payment *@
			<div class="lp-body">
				<button disabled=@(Loans.Count <= 1 || currentIndex == 0) class="arrow-btn" @onclick="PreviousLoan"> <IconCaret Direction="l" Size="30" /> </button>
				<div class="lp-b-body">
					<h2 class="lp-b-b-header">
						@CurrentLoan.Name
					</h2>
					<div class="lp-b-b-payment">
						@CurrentLoan.Payment_C.ToString("C0") <span class="per-tag">/mo</span>
					</div>
				</div>
				<button disabled=@(Loans.Count <= 1 || currentIndex == (Loans.Count - 1)) class="arrow-btn" @onclick="NextLoan"> <IconCaret Direction="r" Size="30" /> </button>
			</div>
			@* Progress Bar *@
			<div class="lp-footer">
				@* The Num container rests exactly above the bar container *@
				<div class="lp-f-green-num-container">
					<div class="green-num" style="left: @CurrentLoan.Percent_Of_Loan_Paid_C.ToString("P0")">@CurrentLoan.Total_Paid_C.ToString("C0")</div>
				</div>
				<div class="lp-f-bar-container">
					<div class="green-bar" style="width: @CurrentLoan.Percent_Of_Loan_Paid_C.ToString("P0")"></div>
					<div class="red-bar" style="width: @CurrentLoan.Percent_Of_Loan_Remaining_C.ToString("P0")"></div>
				</div>
				<div class="lp-f-red-num-container">
					<div class="red-num">@CurrentLoan.Total_Loan_Amount_C.ToString("C0")</div>
				</div>
			</div>
		</div>
	}
}

@code {
	[Parameter] public List<Loan> Loans { get; set; } = new();
	[Parameter] public bool IsSmall { get; set; } = false;

	private int currentIndex = 0;

	private Loan CurrentLoan => Loans[currentIndex];

	private void NextLoan()
	{
		if (Loans.Count > 0)
		{
			currentIndex = (currentIndex + 1) % Loans.Count;
		}
	}

	private void PreviousLoan()
	{
		if (Loans.Count > 0)
		{
			currentIndex = (currentIndex - 1 + Loans.Count) % Loans.Count;
		}
	}
}